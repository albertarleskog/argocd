{
   "apiVersion": "apps/v1",
   "kind": "StatefulSet",
   "metadata": {
      "name": "plex",
      "namespace": "plex"
   },
   "spec": {
      "replicas": 1,
      "selector": {
         "matchLabels": {
            "app": "plex"
         }
      },
      "serviceName": "plex",
      "template": {
         "metadata": {
            "labels": {
               "app": "plex"
            },
            "name": "plex"
         },
         "spec": {
            "containers": [
               {
                  "env": [
                     {
                        "name": "PLEX_UID",
                        "value": "1000"
                     },
                     {
                        "name": "PLEX_GID",
                        "value": "1000"
                     },
                     {
                        "name": "TZ",
                        "value": "Europe/Stockholm"
                     }
                  ],
                  "image": "plexinc/pms-docker:latest",
                  "name": "plex",
                  "ports": [
                     {
                        "containerPort": 32400
                     }
                  ],
                  "resources": {
                     "limits": {
                        "cpu": "250m",
                        "memory": "512Mi",
                        "nvidia.com/gpu": 1
                     },
                     "requests": {
                        "cpu": "100m",
                        "memory": "256Mi",
                        "nvidia.com/gpu": 1
                     }
                  },
                  "volumeMounts": [
                     {
                        "mountPath": "/config",
                        "name": "config"
                     },
                     {
                        "mountPath": "/data",
                        "name": "media"
                     }
                  ]
               }
            ],
            "dnsConfig": {
               "options": [
                  {
                     "name": "ndots",
                     "value": "1"
                  }
               ]
            },
            "volumes": [
               {
                  "name": "media",
                  "nfs": {
                     "path": "/mnt/tank/media",
                     "server": "10.1.40.100"
                  }
               }
            ]
         }
      },
      "volumeClaimTemplates": [
         {
            "metadata": {
               "name": "config"
            },
            "spec": {
               "accessModes": [
                  "ReadWriteOnce"
               ],
               "resources": {
                  "requests": {
                     "storage": "12Gi"
                  }
               },
               "storageClassName": "longhorn"
            }
         }
      ]
   }
}
